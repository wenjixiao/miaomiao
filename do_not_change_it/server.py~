class MsgServerProtocol(msgprotocol.MsgProtocol):
    def __init__(self):
        msgprotocol.MsgProtocol.__init__(self)
    # override
    def connection_lost(self,exc):
        logging.debug("connection losted")
        msgprotocol.MsgProtocol.connection_lost(self,exc)
        if exc is not None:
        	logging.info("---exit EXCEPTION---")
        	
    # override
    def process_msg(self,msg):
        logging.debug(msg)
        
        # login 
        if msg.type == message.MsgType.TLogin:
            user = msgdb.get_user(msg.login.name)
            if user is not None:
            	# found the user from users db
                logging.debug("---login ok!---")
                
                msg = message.Msg()
                msg.type = message.MsgType.TLoginOk
                self.send_msg(msg)
            else:
            	# the user not in db
                logging.debug("---login error!---")
                msg = message.Msg()
                msg.type = message.MsgType.TLoginFail
                self.send_msg(msg)
        else:
        	# no that msg!
            logging.info("not support the type msg now")

async def main():
    loop = asyncio.get_running_loop()
    
    server = await loop.create_server(
        lambda: MsgServerProtocol(), '127.0.0.1', 5678)
    
    async with server:
        await server.serve_forever()
        
if __name__ == '__main__':
	asyncio.run(main())